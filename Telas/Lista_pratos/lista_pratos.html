<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio Geral - Sabor & Arte</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="lista_pratos.css">

    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>

    <style>
        .section-title {
            border-left: 5px solid #ff7a3d;
            padding-left: 15px;
            margin-bottom: 20px;
        }

        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body class="bg-cardapio">

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top mb-4">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                <div class="icon-brand-small">
                    <span class="iconify text-white" data-icon="mdi:chef-hat"></span>
                </div>
                <span class="fw-bold text-dark">Sabor & Arte</span>
            </a>

            <a id="cart-link" href="../Carrinho_Vazio/carrinho_vazio.html">
                <button class="btn btn-outline-orange position-relative rounded-pill px-4">
                    <span class="iconify me-1" data-icon="mdi:cart-outline"></span>
                    Carrinho
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cart-count">
                        0
                    </span>
                </button>
            </a>
        </div>
    </nav>

    <div class="container pb-5">

        <div class="text-center mb-5">
            <h2 class="fw-bold text-dark">Cardápio Geral</h2>
            <p class="text-muted">Veja todos os nossos itens ou navegue por categoria</p>
        </div>

        <div class="row g-3 mb-5">
            <div class="col-12 col-md-4">
                <a href="#sec-pratos" class="text-decoration-none">
                    <div class="card card-category p-3">
                        <div class="d-flex align-items-center gap-3 justify-content-center">
                            <span class="iconify icon-cat" data-icon="mdi:silverware-fork-knife"></span>
                            <h5 class="m-0 fw-bold text-white">Pratos Principais</h5>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-12 col-md-4">
                <a href="#sec-sobremesas" class="text-decoration-none">
                    <div class="card card-category p-3">
                        <div class="d-flex align-items-center gap-3 justify-content-center">
                            <span class="iconify icon-cat" data-icon="mdi:cupcake"></span>
                            <h5 class="m-0 fw-bold text-white">Sobremesas</h5>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-12 col-md-4">
                <a href="#sec-bebidas" class="text-decoration-none">
                    <div class="card card-category p-3">
                        <div class="d-flex align-items-center gap-3 justify-content-center">
                            <span class="iconify icon-cat" data-icon="mdi:glass-cocktail"></span>
                            <h5 class="m-0 fw-bold text-white">Bebidas</h5>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <section id="sec-pratos" class="mb-5 pt-4">
            <h3 class="fw-bold text-dark section-title">Pratos Principais</h3>
            <div id="list-pratos" class="row g-4"></div>
        </section>

        <section id="sec-sobremesas" class="mb-5 pt-4">
            <h3 class="fw-bold text-dark section-title">Sobremesas</h3>
            <div id="list-sobremesas" class="row g-4"></div>
        </section>

        <section id="sec-bebidas" class="mb-5 pt-4">
            <h3 class="fw-bold text-dark section-title">Bebidas</h3>
            <div id="list-bebidas" class="row g-4"></div>
        </section>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>

        const getCart = () => JSON.parse(localStorage.getItem("sabor_arte_cart") || "{}");
        const saveCart = cart => localStorage.setItem("sabor_arte_cart", JSON.stringify(cart));

        function updateCartCount() {
            const cart = getCart();
            let total = 0;

            for (const id in cart) total += cart[id].quantity;

            document.getElementById("cart-count").textContent = total;
            updateCartLink(total);
        }

        function updateCartLink(total) {
            const link = document.getElementById("cart-link");
            link.href = total > 0
                ? "../Carrinho_Vazio/carrinho.html"
                : "../Carrinho_Vazio/carrinho_vazio.html";
        }

        function addItem(item, qty) {
            const cart = getCart();

            cart[item.id] = cart[item.id]
                ? { ...cart[item.id], quantity: cart[item.id].quantity + qty }
                : {
                    id: item.id,
                    nome_prato: item.nome_prato,
                    descricao: item.descricao,
                    preco: item.preco,
                    imagem: item.imagem,
                    quantity: qty
                };

            saveCart(cart);
            updateCartCount();
        }

        /* --- RENDERIZAÇÃO DO MENU --- */

        function renderCategory(items, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";

            items.forEach(item => {
                container.innerHTML += `
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card h-100 card-custom">
                    <div class="card-img-wrapper">
                        <img src="../img/${item.imagem}" class="card-img-top" alt="${item.nome_prato}">
                    </div>

                    <div class="card-body d-flex flex-column p-4">
                        <h5 class="card-title fw-bold">${item.nome_prato}</h5>
                        <p class="card-text text-muted small flex-fill">${item.descricao}</p>

                        <h4 class="price-text mb-3">R$ ${item.preco.toFixed(2).replace(".", ",")}</h4>

                        <div class="d-flex gap-2">
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <button class="btn btn-light border btn-dec" type="button">-</button>
                                <input type="number" class="form-control text-center bg-light border-start-0 border-end-0 qty" value="1" readonly>
                                <button class="btn btn-light border btn-inc" type="button">+</button>
                            </div>

                            <button class="btn btn-orange flex-fill text-white fw-bold btn-add" data-id="${item.id}">
                                Adicionar
                            </button>
                        </div>

                    </div>
                </div>
            </div>`;
            });
        }

        function attachEvents(menu) {

            document.querySelectorAll(".btn-inc").forEach(btn => {
                btn.addEventListener("click", () => {
                    const input = btn.closest(".input-group").querySelector(".qty");
                    input.value = +input.value + 1;
                });
            });

            document.querySelectorAll(".btn-dec").forEach(btn => {
                btn.addEventListener("click", () => {
                    const input = btn.closest(".input-group").querySelector(".qty");
                    if (input.value > 1) input.value--;
                });
            });

            document.querySelectorAll(".btn-add").forEach(btn => {
                btn.addEventListener("click", () => {
                    const id = btn.dataset.id;
                    const card = btn.closest(".card-body");
                    const qty = parseInt(card.querySelector(".qty").value);

                    addItem(menu[id], qty);

                    btn.textContent = "Adicionado!";
                    setTimeout(() => btn.textContent = "Adicionar", 1000);
                });
            });
        }

        /* --- CARREGA MENU --- */

        async function loadMenu() {
            try {
                updateCartCount();

                const response = await fetch("/api/menu");
                const data = await response.json();

                const menu = {};

                ["Pratos Principais", "Sobremesas", "Bebidas"].forEach(cat => {
                    (data[cat] || []).forEach(item => menu[item.id] = item);
                });

                renderCategory(data["Pratos Principais"], "list-pratos");
                renderCategory(data["Sobremesas"], "list-sobremesas");
                renderCategory(data["Bebidas"], "list-bebidas");

                attachEvents(menu);

            } catch (error) {
                console.error("Erro ao carregar cardápio:", error);
            }
        }

        loadMenu();
    </script>

</body>
</html>
